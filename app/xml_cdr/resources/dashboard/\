<?php

//includes
	require_once "root.php";
	require_once "resources/require.php";

//check permisions
	require_once "resources/check_auth.php";
	if (permission_exists('xml_cdr_view')) {
		//access granted
	}
	else {
		echo "access denied";
		exit;
	}

//add multi-lingual support
	$language = new text;
	$text = $language->get($_SESSION['domain']['language']['code'], 'core/user_settings');

//create assigned extensions array
	if (is_array($_SESSION['user']['extension'])) {
		foreach ($_SESSION['user']['extension'] as $assigned_extension) {
			$assigned_extensions[$assigned_extension['extension_uuid']] = $assigned_extension['user'];
		}
	}
//get contact call group
	$sql = "select 
				z.extension_uuid
			from
				v_contact_settings as x
			inner join
				v_users as y
			on
				x.contact_uuid = y.contact_uuid
			inner join
				v_extensions as z
			on
				x.contact_setting_value = z.call_group			
			where
				y.user_uuid = :user_uuid
				and
				x.contact_setting_subcategory = 'inbound_config'
				and
				x.contact_setting_enabled = 'true'";

	$parameters['user_uuid'] = $_SESSION['user_uuid'];
	$database = new database;
	$call_groups_extensions = $database->select($sql, $parameters, 'all');

	if (is_array($call_groups_extensions) && sizeof($call_groups_extensions) != 0) {
		foreach ($call_groups_extensions as $extension) {
			$extensions_list[] = $extension['extension_uuid'];
		}
	}	
	
    echo "<div class='hud_box'>\n";
?>

	<div style='display: center; flex-wrap: wrap;  justify-content: center; '>
		<div><canvas id='calls_bar_chart'></canvas></div>
	</div>

	<script>
		var calls_bar_chart_context = document.getElementById('calls_bar_chart').getContext('2d');
		
		const calls_bar_chart_data = {
			labels: ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00'],
  			datasets: [{
				label: 'Chamadas Recebidas',
				type: 'bar',
				data: [65, 59, 80, 81, 56, 55, 40],
				backgroundColor: 'blue',
				borderColor: 'blue',
				yAxisID: 'yAxisBar',
				borderWidth: 1
			},{
				label: 'Chamadas Perdidas',
				type: 'bar',
				data: [35, 20, 70, 11, 30, 27, 35],
				backgroundColor: 'red',
				borderColor: 'rgb(255, 99, 132)',
				yAxisID: 'yAxisBar',
				borderWidth: 1
			},{
				label: 'Tempo de Espera',
				type: 'line',
				data: [5, 8.8, 10, 11, 6, 7, 6],
				backgroundColor: 'rgba(255, 99, 132, 0.3)',
				borderColor: 'rgb(255, 99, 132)',
				yAxisID: 'yAxisLine',
				borderWidth: 1
		}]
		};

		const calls_bar_chart_options = {
			scales: {
				xAxes: {
					stacked: true,
				},
				yAxisBar: {
				},
				yAxisLine: {
					position: 'right',
				},
				maintainAspectRatio: false,
			}
		};

		const calls_bar_chart_config = {
			type: 'bar',
			data: calls_bar_chart_data,
			options: calls_bar_chart_options

		};

		const calls_bar_chart = new Chart(calls_bar_chart_context, calls_bar_chart_config);
	</script>
	<?php

echo "</div>\n";

?>

